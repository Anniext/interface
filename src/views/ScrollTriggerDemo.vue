<template>
    <div class="scroll-trigger-demo">
        <!-- ScrollTrigger åŠ¨ç”»å®¹å™¨ -->
        <ScrollTriggerAnimation
            :show-progress="true"
            progress-type="horizontal"
            progress-position="top"
            progress-color="#3b82f6"
            :debug="debugMode"
            auto-animate-selector=".animate-on-scroll"
            :parallax-config="parallaxConfig"
            ref="scrollTriggerRef">
            <!-- è‹±é›„åŒºåŸŸ -->
            <section
                class="hero-section min-h-screen flex items-center justify-center bg-linear-to-br from-blue-900 via-purple-900 to-indigo-900 relative overflow-hidden">
                <div class="parallax-bg absolute inset-0 opacity-30">
                    <div class="floating-shapes">
                        <div class="shape shape-1"></div>
                        <div class="shape shape-2"></div>
                        <div class="shape shape-3"></div>
                    </div>
                </div>

                <div class="hero-content text-center text-white z-10">
                    <h1 class="text-6xl font-bold mb-6 animate-on-scroll">
                        ScrollTrigger æ¼”ç¤º
                    </h1>
                    <p class="text-xl mb-8 animate-on-scroll">
                        ä½“éªŒå¼ºå¤§çš„æ»šåŠ¨è§¦å‘åŠ¨ç”»æ•ˆæœ
                    </p>
                    <button
                        @click="scrollToNext"
                        class="btn-primary animate-on-scroll">
                        å¼€å§‹æ¢ç´¢
                    </button>
                </div>
            </section>

            <!-- åŠŸèƒ½å±•ç¤ºåŒºåŸŸ -->
            <section class="features-section py-20 bg-white">
                <div class="container mx-auto px-4">
                    <h2
                        class="text-4xl font-bold text-center mb-16 animate-on-scroll">
                        æ ¸å¿ƒåŠŸèƒ½
                    </h2>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div
                            class="feature-card p-6 bg-gray-50 rounded-lg animate-on-scroll">
                            <div class="feature-icon text-4xl mb-4">ğŸ¯</div>
                            <h3 class="text-xl font-semibold mb-4">ç²¾ç¡®è§¦å‘</h3>
                            <p class="text-gray-600">
                                åŸºäºå…ƒç´ ä½ç½®ç²¾ç¡®æ§åˆ¶åŠ¨ç”»è§¦å‘æ—¶æœº
                            </p>
                        </div>

                        <div
                            class="feature-card p-6 bg-gray-50 rounded-lg animate-on-scroll">
                            <div class="feature-icon text-4xl mb-4">âš¡</div>
                            <h3 class="text-xl font-semibold mb-4">
                                é«˜æ€§èƒ½åŠ¨ç”»
                            </h3>
                            <p class="text-gray-600">
                                GSAP é©±åŠ¨çš„é«˜æ€§èƒ½åŠ¨ç”»æ•ˆæœ
                            </p>
                        </div>

                        <div
                            class="feature-card p-6 bg-gray-50 rounded-lg animate-on-scroll">
                            <div class="feature-icon text-4xl mb-4">ğŸ“±</div>
                            <h3 class="text-xl font-semibold mb-4">
                                å“åº”å¼è®¾è®¡
                            </h3>
                            <p class="text-gray-600">
                                å®Œç¾é€‚é…å„ç§è®¾å¤‡å’Œå±å¹•å°ºå¯¸
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- è§†å·®æ»šåŠ¨åŒºåŸŸ -->
            <section
                class="parallax-section min-h-screen relative overflow-hidden">
                <div class="parallax-bg-1 absolute inset-0"></div>
                <div class="parallax-bg-2 absolute inset-0"></div>

                <div
                    class="parallax-content text-center text-white z-10 min-h-screen flex items-center justify-center">
                    <div>
                        <h2 class="text-5xl font-bold mb-6 animate-on-scroll">
                            è§†å·®æ»šåŠ¨æ•ˆæœ
                        </h2>
                        <p class="text-xl animate-on-scroll">
                            åˆ›é€ æ·±åº¦æ„Ÿå’Œæ²‰æµ¸å¼ä½“éªŒ
                        </p>
                    </div>
                </div>
            </section>

            <!-- æ‰¹é‡åŠ¨ç”»åŒºåŸŸ -->
            <section class="batch-animation-section py-20 bg-gray-100">
                <div class="container mx-auto px-4">
                    <h2
                        class="text-4xl font-bold text-center mb-16 animate-on-scroll">
                        æ‰¹é‡åŠ¨ç”»æ•ˆæœ
                    </h2>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div
                            v-for="i in 12"
                            :key="i"
                            class="batch-item p-4 bg-white rounded-lg shadow-sm">
                            <div class="item-content text-center">
                                <div class="item-number">
                                    {{ i.toString().padStart(2, "0") }}
                                </div>
                                <div class="item-title">åŠ¨ç”»é¡¹ç›®</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- å›ºå®šå…ƒç´ åŒºåŸŸ -->
            <section class="pin-section min-h-screen bg-black text-white">
                <div class="pin-content">
                    <div class="pinned-element">
                        <h2 class="text-4xl font-bold mb-6">å›ºå®šå…ƒç´ åŠ¨æ•ˆæœ</h2>
                        <p class="text-lg">å…ƒç´ åœ¨æ»šåŠ¨è¿‡ç¨‹ä¸­ä¿æŒå›ºå®šä½ç½®</p>
                    </div>
                </div>
            </section>
        </ScrollTriggerAnimation>

        <!-- è°ƒè¯•æ§åˆ¶é¢æ¿ -->
        <div
            class="debug-panel fixed bottom-4 right-4 p-4 bg-white/90 rounded-lg shadow-lg backdrop-blur-sm">
            <h3 class="font-bold mb-2">è°ƒè¯•æ§åˆ¶</h3>
            <div class="space-y-2">
                <label class="flex items-center">
                    <input v-model="debugMode" type="checkbox" class="mr-2" />
                    è°ƒè¯•æ¨¡å¼
                </label>
                <button
                    @click="refreshAnimations"
                    class="w-full px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">
                    åˆ·æ–°åŠ¨ç”»
                </button>
                <button
                    @click="toggleAnimations"
                    class="w-full px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700">
                    åˆ‡æ¢åŠ¨ç”»
                </button>
            </div>
        </div>
    </div>
</template>

<script setup lang="ts">
import { ref, onMounted, computed } from "vue";
import ScrollTriggerAnimation from "@/components/animation/ScrollTriggerAnimation.vue";

// ç»„ä»¶å¼•ç”¨
const scrollTriggerRef = ref();

// å“åº”å¼æ•°æ®
const debugMode = ref(false);
const animationsEnabled = ref(true);

// è§†å·®é…ç½®
const parallaxConfig = computed(() => [
    {
        element: ".parallax-bg-1",
        speed: -0.5,
        direction: "vertical" as const,
    },
    {
        element: ".parallax-bg-2",
        speed: 0.3,
        direction: "vertical" as const,
    },
    {
        element: ".floating-shapes",
        speed: 0.2,
        direction: "vertical" as const,
    },
]);

// æ–¹æ³•
const scrollToNext = () => {
    const nextSection = document.querySelector(".features-section");
    if (nextSection) {
        nextSection.scrollIntoView({ behavior: "smooth" });
    }
};

const refreshAnimations = () => {
    if (scrollTriggerRef.value) {
        scrollTriggerRef.value.refresh();
    }
};

const toggleAnimations = () => {
    animationsEnabled.value = !animationsEnabled.value;
    // è¿™é‡Œå¯ä»¥æ·»åŠ ç¦ç”¨/å¯ç”¨åŠ¨ç”»çš„é€»è¾‘
};

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
    // æ·»åŠ è‡ªå®šä¹‰æ»šåŠ¨è§¦å‘å™¨
    setTimeout(() => {
        if (scrollTriggerRef.value) {
            // æ·»åŠ æ‰¹é‡åŠ¨ç”»
            scrollTriggerRef.value.addBatchAnimation(
                ".batch-item",
                {
                    y: 30,
                    opacity: 0,
                },
                {
                    y: 0,
                    opacity: 1,
                },
                {
                    duration: 0.4,
                    stagger: 0.1,
                },
            );

            // æ·»åŠ å›ºå®šå…ƒç´ åŠ¨ç”»
            scrollTriggerRef.value.addPinAnimation({
                trigger: ".pin-section",
                pin: ".pinned-element",
                start: "top top",
                end: "bottom top",
                scrub: true,
                pinSpacing: true,
                markers: debugMode.value,
            });
        }
    }, 200);
});
</script>

<style scoped>
/* åŸºç¡€æ ·å¼ */
.scroll-trigger-demo {
    overflow-x: hidden;
}

/* è‹±é›„åŒºåŸŸæ ·å¼ */
.hero-section {
    position: relative;
}

.floating-shapes {
    position: absolute;
    inset: 0;
}

.shape {
    position: absolute;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    animation: float 6s ease-in-out infinite;
}

.shape-1 {
    width: 100px;
    height: 100px;
    top: 20%;
    left: 10%;
    animation-delay: 0s;
}

.shape-2 {
    width: 150px;
    height: 150px;
    top: 60%;
    right: 15%;
    animation-delay: 2s;
}

.shape-3 {
    width: 80px;
    height: 80px;
    bottom: 20%;
    left: 70%;
    animation-delay: 4s;
}

@keyframes float {
    0%,
    100% {
        transform: translateY(0px);
    }
    50% {
        transform: translateY(-20px);
    }
}

/* æŒ‰é’®æ ·å¼ */
.btn-primary {
    padding: 2rem 2rem;
    background-color: #2563eb;
    color: white;
    border-radius: 0.5rem;
    font-weight: bold;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    background-color: #1d4ed8;
    transform: scale(1.05);
}

/* åŠŸèƒ½å¡ç‰‡æ ·å¼ */
.feature-card {
    transition: all 0.3s ease;
}

.feature-card:hover {
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    background-color: #f3f4f6;
}

.feature-icon {
    color: #2563eb;
}

/* è§†å·®èƒŒæ™¯æ ·å¼ */
.parallax-bg-1 {
    position: absolute;
    inset: 0;
    background: linear-gradient(
        45deg,
        rgba(59, 130, 246, 0.1),
        rgba(147, 51, 234, 0.1)
    );
    background-size: 100px 100px;
    background-image: radial-gradient(
        circle at 50px 50px,
        rgba(255, 255, 255, 0.1) 2px,
        transparent 2px
    );
}

.parallax-bg-2 {
    position: absolute;
    inset: 0;
    background: linear-gradient(
        -45deg,
        rgba(236, 72, 153, 0.1),
        rgba(59, 130, 246, 0.1)
    );
    background-size: 150px 150px;
    background-image: radial-gradient(
        circle at 75px 75px,
        rgba(255, 255, 255, 0.05) 3px,
        transparent 3px
    );
}

/* æ‰¹é‡åŠ¨ç”»é¡¹ç›®æ ·å¼ */
.batch-item {
    text-align: center;
    transition: background-color 0.3s ease;
}

.batch-item:hover {
    background-color: #e5e7eb;
}

.item-content {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.item-number {
    font-size: 1.5rem;
    font-weight: bold;
    color: #2563eb;
}

.item-title {
    font-size: 0.875rem;
    color: #4b5563;
}

/* å›ºå®šå…ƒç´ æ ·å¼ */
.pin-content {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

.pinned-element {
    text-align: center;
    padding: 2rem;
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 0.5rem;
    backdrop-filter: blur(4px);
}

/* è°ƒè¯•é¢æ¿æ ·å¼ */
.debug-panel {
    backdrop-filter: blur(8px);
    background: rgba(255, 255, 255, 0.9);
    z-index: 1000;
}

.debug-panel h3 {
    font-size: 0.875rem;
    font-weight: 600;
    color: #1f2937;
}

.debug-panel button {
    transition: all 0.2s ease;
}

.debug-panel button:hover {
    transform: scale(1.05);
}

/* å“åº”å¼é€‚é… */
@media (max-width: 768px) {
    .hero-content h1 {
        font-size: 2.25rem;
    }

    .hero-content p {
        font-size: 1.125rem;
    }

    .features-section h2 {
        font-size: 1.875rem;
    }

    .parallax-content h2 {
        font-size: 1.875rem;
    }

    .debug-panel {
        bottom: 0.5rem;
        right: 0.5rem;
        min-width: 150px;
    }

    .shape {
        opacity: 0.5;
    }
}

/* æš—è‰²ä¸»é¢˜æ”¯æŒ */
@media (prefers-color-scheme: dark) {
    .feature-card {
        background-color: #1f2937;
        color: white;
    }

    .batch-item {
        background-color: #1f2937;
        color: white;
    }

    .batch-item:hover {
        background-color: #374151;
    }

    .item-title {
        color: #d1d5db;
    }
}

/* åŠ¨ç”»ä¼˜åŒ– */
@media (prefers-reduced-motion: reduce) {
    .shape {
        animation: none;
    }

    .btn-primary,
    .feature-card,
    .batch-item {
        transition: none;
    }

    .feature-card:hover {
        transform: none;
    }
}
</style>
